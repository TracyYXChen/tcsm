from os.path import join
include: "../TCGA-HR-experiment/Snakefile"

OUTPUT_DIR = 'processed'


STM_NORMALIZED_EXPOSURES_FILE=join(OUTPUT_DIR, 'stm-normalized-exposures_{covariates}_{K}_TCGA-BRCA.tsv')
STM_TEST_EXPOSURES_FILE=join(OUTPUT_DIR, 'stm-test-exposures_{covariates}_{K}_TCGA-BRCA_{fold}.tsv')
STM_TRAIN_EXPOSURES_FILE=join(OUTPUT_DIR, 'stm-train-exposures_{covariates}_{K}_TCGA-BRCA_{fold}.tsv')
TEST_FEATURE_FILE=join(OUTPUT_DIR, "features-test_TCGA-BRCA_{fold}.tsv")
TRAIN_FEATURE_FILE=join(OUTPUT_DIR, "features-train_TCGA-BRCA_{fold}.tsv")
FEATURE_FILE=join(OUTPUT_DIR, "TCGA-BRCA_features.tsv")

HELDOUT_AUC_FILE=join(OUTPUT_DIR, 'linear-svm-heldout-accuracy_{covariates}_{K}.pdf')
OVERALL_HELDOUT_PREDICTION_ACCURACY_FILE=join(OUTPUT_DIR, 'linear-svm-heldout-accuracy.tsv')
MODEL_PREDICTION_AUC_FILE=join(OUTPUT_DIR, 'linear-svm-accuracy_{covariates}_{K}.pdf')


N_FOLDS=5
FOLDS=range(0, N_FOLDS)


rule predict_all:
    input:
        # OVERALL_HELDOUT_PREDICTION_ACCURACY_FILE,
        # expand(MODEL_PREDICTION_AUC_FILE, covariates=["BRCA12", "NULL"], K=5),
        expand(HELDOUT_AUC_FILE, covariates=["BRCA12", "NULL"], K=6)


rule run_LinearSVC_CV:
    input:
        STM_NORMALIZED_EXPOSURES_FILE,
        FEATURE_FILE
    output:
        MODEL_PREDICTION_AUC_FILE
    script:
        "src/run_LinearSVC_CV.py"

# rule combine_prediction_accuracy:
#     input:
#         expand(HELDOUT_PREDICTION_ACCURACY_FILE, covariates=["BRCA12", "NULL"], K=5, fold=FOLDS)
#     output:
#         OVERALL_HELDOUT_PREDICTION_ACCURACY_FILE
#     script:
#         "src/combine_prediction_accuracy.py"

rule run_LinearSVC:
    input:
        expand(STM_TRAIN_EXPOSURES_FILE, covariates="{covariates}", K="{K}", fold=FOLDS),
        expand(STM_TEST_EXPOSURES_FILE, covariates="{covariates}", K="{K}", fold=FOLDS),
        expand(TRAIN_FEATURE_FILE, covariates="{covariates}", K="{K}", fold=FOLDS),
        expand(TEST_FEATURE_FILE, covariates="{covariates}", K="{K}", fold=FOLDS)
    output:
        HELDOUT_AUC_FILE
    script:
        "src/run_LinearSVC.py"
